import { Accordion } from '@aws-amplify/ui-react';
import ReactPropsTable from '@/components/propsTable/ReactPropsTable';
import { Example, ExampleCode } from '@/components/Example';
import { StorageBrowser } from './examples/MockStorageBrowser.tsx'
import { DISPLAY_TEXT, COPY_VIEW_DISPLAY_TEXT } from './props.ts'
import {I18n, Custom, ComposedLocations, ComposedUpload } from './examples'

## Overview

<StorageBrowser />

The `StorageBrowser` component 



## Setup and Authentication

The `StorageBrowser` component is the first Amplify UI component to support different authentication method other than Amplify Auth using Amazon Cognito. 

In order to show S3 locations and their contents to end users, you first need to set up your preferred authentication and authorization methods. There are 3 ways you can set up authentication/authorization with the storage browser component:

1. **Amplify auth:** If you are already using Amplify then this option lets you get started the fastest. It uses Amazon Cognito for authentication and IAM policies for authorization and access. And by using Amplify Gen 2, the access rules for users and groups can be customized.
2. **AWS IAM Identity Center and S3 Access Grants:** We recommend this option if you want to grant access on a per-S3-prefix basis to both IAM principals and directly to users or groups from your corporate directory. With S3 Access Grants capabilities, applications can request data from Amazon S3 on behalf of the current authenticated user. This means your applications no longer need to first map the user to an IAM principal. And when you use S3 Access Grants with IAM Identity Center trusted identity propagation, each AWS CloudTrail data event for S3 references the end user identity that accessed your data.
3. **Custom auth:** We recommend this option if you have your own identity and authorization service for authenticating and authorizing users in your application. To use this option, you will need to provide the list of S3 locations to display to the user and a mechanism for fetching scoped credentials for each location.

### Amplify Auth

Make sure you have an Amplify Gen2 project started, by following the [getting started guides](https://docs.amplify.aws/react/start/quickstart/). Then create an S3 bucket with access rules by [defining a storage resource and adding authorization rules](https://docs.amplify.aws/react/build-a-backend/storage/authorization/):

```ts
export const storage = defineStorage({
  name: 'myProjectFiles',
  access: (allow) => ({
    'public/*': [
      allow.guest.to(['read']),
      allow.authenticated.to(['read', 'write', 'delete']),
    ],
    'protected/{entity_id}/*': [
      allow.authenticated.to(['read']),
      allow.entity('identity').to(['read', 'write', 'delete'])
    ],
    'private/{entity_id}/*': [
      allow.entity('identity').to(['read', 'write', 'delete'])
    ]
  })
});
```

Then in your React code, call `Amplify.configure()` with your `amplify_outputs.json`. If you have some access rules that require a logged in user, like `allow.authenticated`, you can wrap your page in the [`<Authenticator>`]() component. 

### IAM Identity Center and S3 Access Grants

### Custom auth



## Customization

### Theming

### Display Text

```tsx
<StorageBrowser
  displayText={{
    LocationsView: {
      title: 'Storage Browser Home'
    }
  }}
/>
```

<Accordion items={DISPLAY_TEXT.map(({key,props}) => {
  return {
    trigger: key,
    value: key,
    content: <ReactPropsTable props={props} />
  }
})}
/>

#### Internationalization

You can use the `displayText` prop to also support different languages. Use an open source library like i18next, react-intl, or make your own:

<Example>
  <I18n />
  <ExampleCode>
    ```jsx file=./examples/i18n.tsx
    ```
  </ExampleCode>
</Example>

### Composition

If you wanted to move around some of the components in the Locations view without wanting to rebuild the entire view yourself, you can use the composable components of the Locations view. You will first need to use the `useView('Locations')` hook and pass its return to the `<StorageBrowser.LocationsView.Provider>` and then the children of the provider can be the composed sub-components. 


### Custom UI

The `createStorageBrowser` function returns the `<StorageBrowser>` component as well as two hooks: `useView()` and `useAction()`. These hooks are built so that you can use the Storage Browser's internal state and handlers to build your own UI on top the Storage Browser functionality.

<Example>
  <Custom />
  <ExampleCode>
    ```jsx file=./examples/Custom.tsx
    ```
  </ExampleCode>
</Example>


The `useView()` hook takes a single argument which is the name of the view you want to get the state and handlers for. The available views are `Locations`, `LocationDetails`, `Copy`, `Upload`, `Delete`, and `CreateFolder`. The return of the hook will have all the necessary internal state and handlers required to build that view. In fact, the Storage Browser component itself uses the `useView()` to manage its state, so you can build the UI exactly how we do!


## View reference

### Locations view

#### Locations view state

```ts
interface LocationsViewState {
  hasNextPage: boolean;
  hasError: boolean;
  highestPageVisited: number;
  isLoading: boolean;
  message: string | undefined;
  shouldShowEmptyMessage: boolean;
  pageItems: LocationData[];
  page: number;
  searchQuery: string;
  hasExhaustedSearch: boolean;
  onDownload: (item: LocationData) => void;
  onNavigate: (location: LocationData) => void;
  onRefresh: () => void;
  onPaginate: (page: number) => void;
  onSearch: () => void;
  onSearchQueryChange: (value: string) => void;
  onSearchClear: () => void;
}
```

#### Locations view composable components

```tsx
Provider: (props: LocationsViewProviderProps) => React.JSX.Element;
LoadingIndicator: () => React.JSX.Element | null;
LocationsTable: () => React.JSX.Element | null;
Message: () => React.JSX.Element | null;
Pagination: () => React.JSX.Element | null;
Refresh: () => React.JSX.Element | null;
Search: () => React.JSX.Element | null;
Title: () => React.JSX.Element | null;
```

<Example>
  <ComposedLocations />
  <ExampleCode>
    ```jsx file=./examples/ComposedLocations.tsx
    ```
  </ExampleCode>
</Example>

### LocationDetails view

#### LocationDetails view state

```ts
interface LocationDetailViewState {
  actions: ActionsListItem[];
  hasError: boolean;
  hasNextPage: boolean;
  hasDownloadError: boolean;
  highestPageVisited: number;
  isLoading: boolean;
  isSearchingSubfolders: boolean;
  location: LocationState;
  areAllFilesSelected: boolean;
  fileDataItems: FileDataItem[] | undefined;
  hasFiles: boolean;
  message: string | undefined;
  downloadErrorMessage: string | undefined;
  shouldShowEmptyMessage: boolean;
  searchQuery: string;
  hasExhaustedSearch: boolean;
  pageItems: LocationItemData[];
  page: number;
  onActionSelect: (actionType: string) => void;
  onDropFiles: (files: File[]) => void;
  onRefresh: () => void;
  onNavigate: (location: LocationData, path?: string) => void;
  onNavigateHome: () => void;
  onPaginate: (page: number) => void;
  onDownload: (fileItem: FileDataItem) => void;
  onSelect: (isSelected: boolean, fileItem: FileData) => void;
  onSelectAll: () => void;
  onSearch: () => void;
  onSearchClear: () => void;
  onSearchQueryChange: (value: string) => void;
  onToggleSearchSubfolders: () => void;
}
```

### Upload view

<Example>
  <ComposedUpload />
  <ExampleCode>
    ```jsx file=./examples/ComposedUpload.tsx
    ```
  </ExampleCode>
</Example>


### Copy view

### Delete view

### CreateFolder view
